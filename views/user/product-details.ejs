<%- include ('./includes/header.ejs') %>

    <body class="bg-gray-50">
        <!-- Navigation -->
        <%- include ('./includes/navbar.ejs') %>
            <!-- Breadcrumbs -->
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                <nav class="flex" aria-label="Breadcrumb">
                    <ol class="flex items-center space-x-4">
                        <li>
                            <div>
                                <a href="" class="text-gray-400 hover:text-gray-500">
                                    <i class="fas fa-home"></i>
                                    <span class="sr-only">Home</span>
                                </a>
                            </div>
                        </li>
                        <li>
                            <div class="flex items-center">
                                <i class="fas fa-chevron-right text-gray-400 text-sm"></i>
                                <a href="#"
                                    class="ml-4 text-sm font-medium text-gray-500 hover:text-gray-700">Featured</a>
                            </div>
                        </li>
                        <li>
                            <div class="flex items-center">
                                <i class="fas fa-chevron-right text-gray-400 text-sm"></i>
                                <span class="ml-4 text-sm font-medium text-gray-700" aria-current="page">
                                    <%=product.product_name%>
                                </span>
                            </div>
                        </li>
                    </ol>
                </nav>
            </div>

            <!-- Product Details -->
            <div class="bg-white">
                <div class="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
                    <div class="lg:grid lg:grid-cols-2 lg:gap-x-8">
                        <!-- Product images -->
                        <div class="lg:max-w-lg lg:self-end">
                            <div class="aspect-w-1 aspect-h-1 rounded-lg overflow-hidden">
                                <img src="<%=product.imageUrl%>" alt="Product image"
                                    class="w-full h-full object-center object-cover">
                            </div>
                        </div>

                        <!-- Product details -->
                        <div class="mt-10 px-4 sm:px-0 sm:mt-16 lg:mt-0">
                            <h1 class="text-3xl font-extrabold tracking-tight text-gray-900">
                                <%=product.product_name%>
                            </h1>
                            <div class="mt-3">
                                <h2 class="sr-only">Product information</h2>
                                <p class="text-3xl text-gray-900">
                                    <%=product.price%>
                                </p>
                            </div>

                            <!-- Reviews -->
                            <div class="mt-3">
                                <h3 class="sr-only">Reviews</h3>
                                <div class="flex items-center">
                                    <div class="flex items-center">
                                        <i class="fas fa-star text-yellow-400"></i>
                                        <i class="fas fa-star text-yellow-400"></i>
                                        <i class="fas fa-star text-yellow-400"></i>
                                        <i class="fas fa-star text-yellow-400"></i>
                                        <i class="fas fa-star-half-alt text-yellow-400"></i>
                                    </div>
                                    <p class="ml-2 text-sm text-gray-500">4.5 (128 reviews)</p>
                                </div>
                            </div>

                            <div class="mt-6">
                                <h3 class="sr-only">Description</h3>
                                <p class="text-base text-gray-700">
                                    <%=product.description%>
                                </p>
                            </div>

                            <div class="mt-6">
                                <div class="flex items-center">
                                    <i class="fas fa-check-circle text-green-500"></i>
                                    <p class="ml-2 text-sm text-gray-500">In stock and ready to ship</p>
                                </div>
                            </div>

                            <form class="mt-6">
                                <!-- Quantity -->
                                <div class="mt-6">
                                    <h3 class="text-sm text-gray-600">Quantity</h3>
                                    <div class="mt-2 flex items-center">
                                        <button type="button"
                                            class="p-2 border rounded-md text-gray-600 hover:bg-gray-50">
                                            <i class="fas fa-minus"></i>
                                        </button>
                                        <input type="number" min="1" value="1"
                                            class="mx-2 w-16 text-center border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                        <button type="button"
                                            class="p-2 border rounded-md text-gray-600 hover:bg-gray-50">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="mt-8 flex sm:flex-col1">
                                    <button type="submit"
                                        class="w-full bg-indigo-600 border border-transparent rounded-md py-3 px-8 flex items-center justify-center text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                        Add to cart
                                    </button>
                                    <button type="button"
                                        class="ml-4 py-3 px-3 rounded-md flex items-center justify-center text-gray-400 hover:bg-gray-100 hover:text-gray-500">
                                        <i class="fas fa-heart"></i>
                                        <span class="sr-only">Add to favorites</span>
                                    </button>
                                </div>
                            </form>

                            <!-- Product details -->
                            <div class="mt-10">

                                <div class="border-t border-gray-200 mt-6 pt-6">
                                    <h3 class="text-lg font-medium text-gray-900">Shipping & Returns</h3>
                                    <div class="mt-4 prose prose-sm text-gray-500">
                                        <p>Free shipping on orders over $50. Standard delivery in 3-5 business days.</p>
                                        <p>Free returns within 30 days of delivery. See our <a href="#"
                                                class="text-indigo-600 hover:text-indigo-500">return policy</a> for more
                                            details.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Reviews Section -->
            <div class="bg-white">
                <div class="max-w-7xl mx-auto px-4 py-12 sm:px-6 lg:px-8">
                    <h2 class="text-2xl font-extrabold tracking-tight text-gray-900">Customer Reviews</h2>
                    <div class="mt-6 border-t border-gray-200 pt-6">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <p class="ml-2 text-sm text-gray-500">Based on <%=reviews.length%> reviews</p>
                            </div>
                            <button id="open-modal"
                                class="bg-indigo-600 text-white hover:bg-indigo-700 px-4 py-2 rounded-md text-sm font-medium">
                                Write a review
                            </button>
                        </div>

                        <!-- Review 1 -->
                        <% reviews.forEach(review=> { %>
                            <div class="mt-8 border-t border-gray-200 pt-8">
                                <div class="flex items-center">
                                    <img class="h-12 w-12 rounded-full"
                                        src="https://w7.pngwing.com/pngs/1000/665/png-transparent-computer-icons-profile-s-free-angle-sphere-profile-cliparts-free.png"
                                        alt="Reviewer">
                                    <div class="ml-4">
                                        <div class="mt-1 flex items-center">
                                            <% for(let i=0; i < review.rating; i++) { %>
                                                <i class="fas fa-star text-yellow-400"></i>
                                                <% } %>
                                                    <% for(let i=0; i < 5 - review.rating; i++) { %>
                                                        <i class="far fa-star text-yellow-400"></i>
                                                        <% } %>
                                        </div>
                                        <p class="text-sm text-gray-500">
                                            <%= new Date(review.created_at).toLocaleDateString() %>
                                        </p>
                                    </div>
                                </div>
                                <div class="mt-4 text-base text-gray-600">
                                    <p>
                                        <%= review.review %>
                                    </p>
                                </div>
                            </div>
                            <% }) %>


                    </div>
                </div>
            </div>

            <!-- Newsletter -->
            <div class="bg-gray-100">
                <div class="max-w-7xl mx-auto px-4 py-12 sm:px-6 lg:py-16 lg:px-8">
                    <div
                        class="px-6 py-6 bg-indigo-700 rounded-lg md:py-12 md:px-12 lg:py-16 lg:px-16 xl:flex xl:items-center">
                        <div class="xl:w-0 xl:flex-1">
                            <h2 class="text-2xl font-extrabold tracking-tight text-white sm:text-3xl">
                                Sign up for our newsletter
                            </h2>
                            <p class="mt-3 max-w-3xl text-lg leading-6 text-indigo-200">
                                Get the latest updates on new products and upcoming sales
                            </p>
                        </div>
                        <div class="mt-8 sm:w-full sm:max-w-md xl:mt-0 xl:ml-8">
                            <form class="sm:flex">
                                <label for="email-address" class="sr-only">Email address</label>
                                <input id="email-address" name="email-address" type="email" autocomplete="email"
                                    required
                                    class="w-full rounded-md border-white px-5 py-3 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-indigo-700"
                                    placeholder="Enter your email">
                                <button type="submit"
                                    class="mt-3 w-full flex items-center justify-center px-5 py-3 border border-transparent rounded-md shadow text-base font-medium text-indigo-600 bg-white hover:bg-indigo-50 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-indigo-700 sm:mt-0 sm:ml-3 sm:w-auto sm:flex-shrink-0">
                                    Subscribe
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <%- include ('./includes/footer.ejs') %>

                <script>
                    document.addEventListener("DOMContentLoaded", function () {
                        const openModalBtn = document.getElementById("open-modal");
                        const modal = document.getElementById("rating-modal");
                        const closeModalBtn = document.getElementById("close-modal");
                        const form = document.getElementById("rating-form");
                        const stars = document.querySelectorAll(".star");
                        const reviewTextElement = document.getElementById("review-text");
                        const errorMessage = document.getElementById("error-message");
                        let rating = 0;

                        openModalBtn.addEventListener("click", () => {
                            modal.classList.remove("hidden");
                        });

                        closeModalBtn.addEventListener("click", () => {
                            modal.classList.add("hidden");
                            errorMessage.textContent = "";
                        });

                        stars.forEach((star, index) => {
                            star.addEventListener("click", () => {
                                rating = index + 1;
                                updateStars(rating);
                            });
                        });

                        function updateStars(rating) {
                            stars.forEach((star, index) => {
                                star.classList.toggle("text-yellow-500", index < rating);
                            });
                        }

                        form.addEventListener("submit", function (event) {
                            event.preventDefault();
                            const reviewText = reviewTextElement.value.trim();

                            if (rating === 0) {
                                errorMessage.textContent = "Please select a star rating.";
                                return;
                            }

                            if (reviewText.length < 10) {
                                errorMessage.textContent = "Review must be at least 10 characters long.";
                                return;
                            }
                            const urlParams = new URLSearchParams(window.location.search);
                            const value = urlParams.get('id'); // Replace 'param' with your query key
                            console.log(value);

                            fetch("/add-review", {
                                method: "POST",
                                body: JSON.stringify({
                                    rating,
                                    reviewText,
                                    pro_id: value
                                }),
                                headers: {
                                    "Content-type": "application/json; charset=UTF-8"
                                }
                            }).then((response) => {
                                location.reload()

                                modal.classList.add("hidden");
                                errorMessage.textContent = "";
                            })
                        });
                    });

                    // Ensure modal HTML is inserted properly
                    document.body.insertAdjacentHTML("beforeend", `
<div id="rating-modal" class="hidden fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center">
    <div class="bg-white rounded-lg p-6 w-96 shadow-lg">
        <h2 class="text-lg font-medium text-gray-700">Rate this Product</h2>
        <p id="error-message" class="text-red-500 text-sm mt-2"></p>
        <form id="rating-form">
            <div id="stars-container" class="flex space-x-2 mt-2">
                <span class="star text-gray-400 text-2xl cursor-pointer">★</span>
                <span class="star text-gray-400 text-2xl cursor-pointer">★</span>
                <span class="star text-gray-400 text-2xl cursor-pointer">★</span>
                <span class="star text-gray-400 text-2xl cursor-pointer">★</span>
                <span class="star text-gray-400 text-2xl cursor-pointer">★</span>
            </div>
            <textarea id="review-text" class="w-full border border-gray-300 rounded-md mt-3 p-2" placeholder="Write your review..."></textarea>
            <div class="flex justify-end space-x-2 mt-4">
                <button type="button" id="close-modal" class="px-4 py-2 bg-gray-300 rounded-md">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md">Submit</button>
            </div>
        </form>
    </div>
</div>`);


                </script>
    </body>

    </html>